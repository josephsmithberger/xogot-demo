[gd_resource type="ShaderMaterial" load_steps=4 format=3 uid="uid://b0aoltqk5eyd6"]

[sub_resource type="Shader" id="Shader_66jco"]
code = "shader_type canvas_item;
render_mode world_vertex_coords;

group_uniforms Squiggle;
/**
 * Noise texture scale
 * By default, the noise texture's size in world coordinates is set by its resolution
*/
uniform vec2 scale = vec2(1.0);
uniform float strength = 1.0;
/**
 * Number of squiggle frames per second
*/
uniform float fps = 6.0;
uniform sampler2D noise : filter_linear, repeat_enable;
group_uniforms;

varying vec4 modulate;
varying vec2 noise_uv;

void vertex() {
	modulate = COLOR;
	
	// Use world coordinates for scale-independent squiggles, offset by position to keep pattern attached to object
	noise_uv = (VERTEX - MODEL_MATRIX[3].xy) / (vec2(textureSize(noise, 0)) * scale);
}

// Use irrational constants for unique squiggles every frame
#define offset_multiplier vec2(PI, E)

void fragment() {
	vec2 noise_offset = vec2(floor(TIME * fps)) * offset_multiplier;
	float noise_sample = texture(noise, noise_uv + noise_offset).r * 4.0 * PI;
	vec2 direction = vec2(cos(noise_sample), sin(noise_sample));
	vec2 squiggle_uv = UV + direction * strength * 0.005;
	
	COLOR = texture(TEXTURE, squiggle_uv) * modulate;
}"

[sub_resource type="FastNoiseLite" id="FastNoiseLite_kbwjl"]
frequency = 0.0115

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_j3dai"]
noise = SubResource("FastNoiseLite_kbwjl")
seamless = true

[resource]
shader = SubResource("Shader_66jco")
shader_parameter/scale = Vector2(1, 1)
shader_parameter/strength = 0.59
shader_parameter/fps = 5.0
shader_parameter/noise = SubResource("NoiseTexture2D_j3dai")
